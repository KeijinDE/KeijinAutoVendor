# KeijinAutoVendor â€“ Dev Notes (v0.1.4)

Modular addon for Turtle WoW (Classic 1.12) â€“ automatically sells gray items and repairs gear when visiting a vendor.

---

## ğŸ“ Core structure (EN)

- `core.lua` â€“ Entry and command handling, triggers repair and sell logic
- `auto_vendor_sell.lua` â€“ Gray item queue and sale logic (based on GrayAutoSell)
- `auto_vendor_repair.lua` â€“ Standalone repair logic, safe and Classic-compatible
- `KeijinAutoVendor.toc` â€“ Interface declaration for v0.1.4

---

## ğŸ§  Technical insights (EN)

1. Direct for-loop selling (`UseContainerItem`) fails due to early bag cache unavailability.
2. Item rarity must be determined via `itemLink` and `GetItemInfo(itemID)`, **not** via `GetContainerItemInfo`.
3. Selling must be delayed using `Frame:SetScript("OnUpdate")` (minimum 0.2s).
4. `GetCoinTextureString()` is unavailable in Classic 1.12 â€“ fallback method (`SafeCoinString`) is used.

---

## ğŸ›  Debug mode (EN)

- Activated via `/kav debug`
- Outputs:
  - Vendor open (`MERCHANT_SHOW`)
  - Item queueing and sale processing

---

## ğŸ§ª Stability (EN)

- No Lua errors during vendor interactions, even with empty bags or low-level characters
- Works without issue on level 1 characters and characters without gear
- Debug and normal operation fully isolated
- Start message shows as expected on login

---

## ğŸ‡©ğŸ‡ª Struktur (DE)

- `core.lua` â€“ Einstiegspunkt, Slash-Befehle, Aufruf von Verkauf und Reparatur
- `auto_vendor_sell.lua` â€“ Verkaufsgesteuerte Queue-Logik Ã¼ber OnUpdate-Frame
- `auto_vendor_repair.lua` â€“ Reparaturfunktion, Classic-kompatibel ohne CoinString-Fehler
- `KeijinAutoVendor.toc` â€“ Strukturdatei fÃ¼r Turtle WoW 1.12

---

## ğŸ§  Technische Erkenntnisse (DE)

1. Direktverkauf mit Schleife (`UseContainerItem`) fÃ¼hrt zu Fehlern â€“ Bag-Daten sind bei MERCHANT_SHOW oft zu frÃ¼h abgefragt.
2. QualitÃ¤t (Rarity) muss Ã¼ber `GetItemInfo(itemID)` + `itemLink` geprÃ¼ft werden â€“ Containerdaten sind unzuverlÃ¤ssig.
3. Verkauf muss Ã¼ber `Frame:SetScript("OnUpdate")` verzÃ¶gert werden â€“ empfohlene Delay-Zeit: **0.2 Sekunden**.
4. `GetCoinTextureString()` ist in WoW 1.12 nicht vorhanden â€“ Fallback-Methode (`SafeCoinString`) wird verwendet.

---

## ğŸ›  Debugmodus (DE)

- Aktivierung per `/kav debug`
- Ausgaben bei:
  - HÃ¤ndlerÃ¶ffnung
  - ReparaturprÃ¼fung und -kosten (nicht funktional)
  - Verkaufsvorgang pro Item

---

## ğŸ§ª StabilitÃ¤t (DE)

- Kein Lua-Fehler bei leerem Inventar oder fehlender ReparaturmÃ¶glichkeit
- Kompatibel mit Level-1-Chars ohne AusrÃ¼stung
- Debug-Ausgaben nur bei aktivem Modus
- Startnachricht erscheint beim Login wie vorgesehen

---

## ğŸ“Œ Geplante Features v0.2.0

- [ ] UI-Button oder zusÃ¤tzlicher Befehl zum manuellen AuslÃ¶sen
- [ ] Whitelist / Blacklist fÃ¼r Itemfilter
- [ ] Lokalisierungssystem (EN/DE)
- [ ] SavedVariable fÃ¼r dauerhaften Debug-Zustand

---

## ğŸ“„ Lizenz / License

- Verkaufslogik basiert auf: **GrayAutoSell v0.1.4**  
- Autor: Thomas T. Cremers  
- Lizenz: **GNU GPL v2 oder spÃ¤ter**  
- Quelle: https://github.com/ttcremers/GrayAutoSell

